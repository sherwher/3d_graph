<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>

    </style>
</head>

<body>
    <div class="node_graph" id="node_graph"></div>
    <div class="node_table" id="node_table"></div>
    <div style="width: 100%; position: absolute; bottom: 0px; align-items: center; display: flex;">
        <button id="btn_start">시작</button>
        <button id="btn_stop">정지</button>
        <button id="btn_slow">느리게</button>
        <button id="btn_fast">빠르게</button>
        <button id="btn_step">다음</button>
        <button id="btn_ableLink">링크사용</button>
        <button id="btn_disableLink">링크사용안함</button>
        <button id="btn_scrollstop">스크롤정지</button>
        <button id="btn_scrollstart">스크롤시작</button>
        <button id="btn_get">좌표가져오기</button>
        <button style="right: 20px; position: absolute;" id="btn_back">이전</button>
        <button style="right: 80px; position: absolute;" id="btn_rewind">뒤감기</button>
        <span id="duration"></span>
        <p></p>
    </div>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <link rel="stylesheet" href="css/nodegraph.css" />
    <script src="js/nodegraph.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <script>
        function randomRange(n1, n2) {
            return Math.floor((Math.random() * (n2 - n1 + 1)) + n1);
        }

        function randomString() {
            var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
            var string_length = 11;
            var randomstring = '';
            for (var i = 0; i < string_length; i++) {
                var rnum = Math.floor(Math.random() * chars.length);
                randomstring += chars.substring(rnum, rnum + 1);
            }
            //document.randform.randomfield.value = randomstring;
            return randomstring;
        }

        // var tics = [];
        // var tx_ram = 1;
        // var tx = []
        // for (var z = 1; z < 2; z++) {
        //     var tics = [];
        //     var tx_ram = z;
        //     for (var j = 1; j < 65; j++) {
        //         for (var i = 1; i < 8; i++) {
        //             tics.push({
        //                 "type": 'tx_detect',
        //                 "from": 'node_' + String(j).padStart(4, '0'),
        //                 "to": 'node_' + String((((j - 1) * 7) + i + 1)).padStart(4, '0'),
        //                 "tx": 'tx' + String(tx_ram).padStart(4, '0')
        //             });
        //         }
        //     }
        //     tx.push(tics);
        //     if (z >= 4) {
        //         tics.push({
        //             "type": 'tx_detect',
        //             "from": null,
        //             "to": null,
        //             "tx": 'tx' + String(tx_ram - 3).padStart(4, '0')
        //         });
        //     }
        // }
        // graph.input_step_data(tx);

        graph.prepare_draw_chart();

        var tics = [];
        var tx_map = new Map();
        this.tx_ram = 1;
        this.i = 1;
        this.j = 1;
        var count = 0;


        function repeatingFunc() {
            // var maxLength = randomRange(1000, 1500);
            var maxLength = 1000;
            tics = [];
            while (tics.length < maxLength) {
                if (i > 43) {
                    i = 1;
                    j = 1;
                }

                tics.push({
                    "type": 'node_to_node',
                    "from": 'node_' + String(i).padStart(4, '0'),
                    "to": 'node_' + String(((i - 1) * 7) + j + 1).padStart(4, '0'),
                    "tx": 'tx' + String(tx_ram).padStart(4, '0')
                });

                if (j % 7 == 0) {
                    j = 1;
                    i++;
                } else {
                    j++;
                }

                if ((((i - 1) * 7) + j + 1) > 302) {
                    // tx_map.set(tx_ram, tx_ram);
                    // if (tx_ram % 2 == 0) {
                    //     var random = randomRange(0, Array.from(tx_map.keys()).length - 1) + 1;
                    //     var key = Array.from(tx_map.keys())[random];
                    //     tx_map.delete(key);
                    //     tics.push({
                    //         "type": 'tx_detected_in_block',
                    //         "from": null,
                    //         "to": null,
                    //         "tx": 'tx' + String(key).padStart(4, '0')
                    //     });
                    // }
                    // if (tx_ram % 3 == 0) {
                    //     var random = randomRange(0, Array.from(tx_map.keys()).length - 1) + 1;
                    //     var key = Array.from(tx_map.keys())[random];
                    //     tx_map.delete(key);
                    //     tics.push({
                    //         "type": 'tx_detected_in_block',
                    //         "from": null,
                    //         "to": null,
                    //         "tx": 'tx' + String(key).padStart(4, '0')
                    //     });
                    // }
                    // if (tx_ram % 5 == 0) {
                    //     var random = randomRange(0, Array.from(tx_map.keys()).length - 1) + 1;
                    //     var key = Array.from(tx_map.keys())[random];
                    //     tx_map.delete(key);
                    //     tics.push({
                    //         "type": 'tx_detected_in_block',
                    //         "from": null,
                    //         "to": null,
                    //         "tx": 'tx' + String(key).padStart(4, '0')
                    //     });
                    // }
                    // if (tx_ram % 7 == 0) {
                    //     var random = randomRange(0, Array.from(tx_map.keys()).length - 1) + 1;
                    //     var key = Array.from(tx_map.keys())[random];
                    //     tx_map.delete(key);
                    //     tics.push({
                    //         "type": 'tx_detected_in_block',
                    //         "from": null,
                    //         "to": null,
                    //         "tx": 'tx' + String(key).padStart(4, '0')
                    //     });
                    // }

                    if (tx_ram > 2) {
                        // var random = randomRange(0, Array.from(tx_map.keys()).length - 1) + 1;
                        // var key = Array.from(tx_map.keys())[random];
                        // tx_map.delete(key);
                        tics.push({
                            "type": 'tx_detected_in_block',
                            "from": null,
                            "to": null,
                            "tx": 'tx' + String(tx_ram - 2).padStart(4, '0')
                        });
                    }
                    tx_ram++;
                }
            }
            graph.input_realtime_data(tics);
            setTimeout(repeatingFunc, 1500);
            count++;
        }
        setTimeout(repeatingFunc, 1500);

        $('#duration').text(graph.duration);


        // 그리기 빠르게 +1초(Max 60초)
        $('#btn_fast').on('click', function (e) {
            graph.toFast();
            $('#duration').text(graph.duration);
        });

        // 그리기 느리게 -1초(Min 1초)
        $('#btn_slow').on('click', function (e) {
            graph.toSlow();
            $('#duration').text(graph.duration);
        });

        // 정지되었던 그리기 다시 시작
        $('#btn_start').on('click', function (e) {
            graph.start();
        });

        // 그리기 정지
        $('#btn_stop').on('click', function (e) {
            graph.stop();
        });

        // tic당 그리기
        $('#btn_step').on('click', function (e) {
            // graph.stepTic()
            graph.stepTick()
        });

        $('#btn_ableLink').on('click', function (e) {
            graph.ableLink();
        });

        $('#btn_disableLink').on('click', function (e) {
            graph.disableLink();
        });

        // <button id="btn_scrollstop">스크롤정지</button>
        // <button id="btn_scrollstart">스크롤시작</button>

        $('#btn_scrollstop').on('click', function (e) {
            graph.stopScroll();
        });

        $('#btn_scrollstart').on('click', function (e) {
            graph.startScroll();
        });

        $('#btn_back').on('click', function (e) {
            graph.toPrev();
        });

        $('#btn_rewind').on('click', function (e) {
            graph.rewind();
        });

        $('#btn_get').on('click', function (e) {
            graph.getXY()
        })
    </script>
</body>

</html>